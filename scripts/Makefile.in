# Makefile for octave's scripts directory
#
# Copyright (C) 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2002,
#               2003, 2004, 2005, 2006, 2007, 2008, 2009 John W. Eaton
#
# This file is part of Octave.
# 
# Octave is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the
# Free Software Foundation; either version 3 of the License, or (at
# your option) any later version.
# 
# Octave is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.
# 
# You should have received a copy of the GNU General Public License
# along with Octave; see the file COPYING.  If not, see
# <http://www.gnu.org/licenses/>.

TOPDIR = ..

script_sub_dir = .

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@

include $(TOPDIR)/Makeconf

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

SOURCES =

ifeq ($(srcdir),.)
  M_FILE_DIRS := $(srcdir)
else
  M_FILE_DIRS := $(srcdir) .
endif

## Define this with =, not := so that the generated plot/gnuplot_binary.m
## file will be included in the list when it is available.
ALL_M_FILES = $(shell find $(M_FILE_DIRS) -name '*.m' -print)

DISTFILES = $(addprefix $(srcdir)/, Makefile.in ChangeLog $(SOURCES) \
	configure.ac configure mkinstalldirs mkdoc mkpkgadd gethelp.cc \
	skip-autoheader move-if-change) DOCSTRINGS

SUBDIRS = audio deprecated elfun general geometry help image io \
	linear-algebra miscellaneous optimization path pkg plot polynomial \
	set signal sparse specfun special-matrix startup \
	statistics strings testfun time

DISTSUBDIRS = $(SUBDIRS)

FCN_FILES = # $(wildcard $(srcdir)/*.m)
FCN_FILES_NO_DIR = # $(notdir $(FCN_FILES))

CONFIG_FILES = @ac_config_files@

all: $(SUBDIRS) DOCSTRINGS
.PHONY: all

configfiles: $(CONFIG_FILES)
.PHONY: configfiles

$(CONFIG_FILES): %: %.in config.status
	./config.status $@

config.status: configure
	./config.status --recheck

configure: configure.ac
	if [ ! -f skip-autoconf ]; then autoconf --force; fi
	if [ ! -f skip-autoheader ]; then autoheader --force; fi

$(SUBDIRS):
	$(MAKE) -C $@ all
.PHONY: $(SUBDIRS)

## Kluge alert:
plot/gnuplot_binary.m:
	$(MAKE) -C plot $(notdir $@)

DOCSTRINGS: plot/gnuplot_binary.m gethelp$(BUILD_EXEEXT) mkdoc $(ALL_M_FILES)
	$(srcdir)/mkdoc $(ALL_M_FILES) > $@.t
	mv $@.t $@

gethelp$(BUILD_EXEEXT): gethelp.cc
	$(BUILD_CXX) $(BUILD_CXXFLAGS) -o $@ $^ $(BUILD_LDFLAGS)

install install-strip uninstall clean mostlyclean distclean maintainer-clean::
	@$(subdir-for-command)
.PHONY: install install-strip uninstall
.PHONY: clean mostlyclean distclean maintainer-clean

tags TAGS:: $(SOURCES)
	$(subdir-for-command)

tags::
	ctags $(SOURCES)

TAGS:: $(SOURCES)
	etags $(SOURCES)

clean distclean maintainer-clean::
	rm -f gethelp$(BUILD_EXEEXT)

distclean maintainer-clean::
	rm -f tags TAGS Makefile config.log config.status DOCSTRINGS
	rm -rf autom4te.cache

maintainer-clean::
	rm -f configure

dist:
	ln $(DISTFILES) ../`cat ../.fname`/scripts
	for dir in $(DISTSUBDIRS); do mkdir ../`cat ../.fname`/scripts/$$dir; $(MAKE) -C $$dir $@; done
.PHONY: dist

check-m-sources:
	@$(subdir-for-command)
.PHONY: check-m-sources
